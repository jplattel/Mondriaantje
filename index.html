<html>                                                                                                                                                                                                                                                                                                                                                                                                      
	<head>
		<title>Boogie Woogie! Mondriaan</title>
		<link rel="stylesheet" href="css/style.css" type="text/css" media="screen" title="no title" charset="utf-8">
		<script src="js/d3.v2.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/md5.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/base64.js" type="text/javascript" charset="utf-8"></script>

		<style type="text/css">
		
		#input-text{
			margin-top: 5px;
			padding-top: 13px;
			padding-bottom: 13px;
		}
		
		#wrapper{
			margin: 0 auto;
			width: 1200px;
			z-index: 0;
		}
		
		#mondriaan{
			margin-top: 10px;
			margin-left: 200px;
		}
		
		#canvas{
			margin-top: -790px;
		}
		
		#save{
			position: absolute;
			top: 50%;
			left: 50%;
			margin-left: -150px;
			margin-top: -50px;
			width: 300px;
			height: 100px;
			text-align: left;
			background-color: white;
			border-radius: 10px;
			-moz-box-shadow: 0 0 40px 1px #888;
			-webkit-box-shadow: 0 0 40px 1px #888;
			box-shadow: 0 0 40px 1px #888;
			padding: 10px;
			display: none;
		}
		.close{
			padding: 5px;
			padding-right: 10px;
			font-size: 12px;
		}
		
		</style>
	</head>
	<body>

	<div class="navbar navbar-fixed-top">
		<div class="navbar-inner">
			<div class="container">
				<a class="brand sigma-font" href="/">Boogie Woogie!</a>
				<div class="nav-collapse">
					<ul class="nav">
						<li><a href="index.html">Home</a></li>
						<li><a href="/about.html">About</a></li>
					</ul>
					<div class="pull-right">
						<ul class="nav">
							<li class="inactive"><a>Generate your own:</a></li>
							<input type="text" placeholder="Type your input..." class="seed input-medium" id="input-text">
							<button class="btn" onclick="javascript:Paint(s, r, l)" value="Generate"/>Generate!</button>
							<button class="btn" onclick="javascript:Save()" value="Save"/>Save!</button>
						</ul>
					</div>	
				</div>
			</div>
		</div>
	</div>
		
	<div id="wrapper">
		<div id="mondriaan"></div>
		<img id="canvas" src="img/bw.png" width="1200" alt="boogie woogie">
	</div>
		
	<div id="save">
		<a href="#" class="close">&times;</a>
		<h2>Save this Mondriaan!</h2><br />
		<p>Right click this link to save the SVG file</p>
		<span id="download"></span>
	</div>	
		
	</body>
	
<script type="text/javascript">	

	// Define SVG and other constants
	var svg = d3.select("#mondriaan").append("svg").attr("width", 800).attr("height", 800);
	var colors = ['#695025', '#f9d23c', '#c6322a', '#26347c', '#17184c', '#c9c8ce', '#ffffff'];
	var s = [];
	var r = [];
	var l = 48;
	var v = 0;
	
	// Paint the canvas with Mondriaan 
	function Paint(s, r, l) {
		s, r = Seed(s, r, l); // Return full seeds
		DrawBackground(s,r);
		DrawLanes(s,r);
		
	}
	
	// Go Piet! 
	function Seed(s, r, l){

		// MD5 from input and then cat to 0-16
		var str = md5($('.seed').val()).split('');
		for (var i=0 ; i < str.length; i++) { s.push(parseInt(str[i], 16)) }
		
		// Generate color seed
		for (var i=0; i <= l; i++) { var a = i / 3; r.push(parseInt((s[a.toFixed()] / 4).toFixed())) }

		// Return seeds
		return s, r
	}
	
	// Draw a rectangle
	function Rectangle(x, y, h, w, c){
		
		// Draw SVG Rect with D3
		 svg.append("svg:rect")
			.attr("x", x )
			.attr("y", y )
			.attr("height", h )
			.attr("width", w )
			.attr("fill", c);
	}
	
	function Pole(r, s, i){
		if (r[i] >= 3){
			return -s[i] * 5
		} else if (r[i] <= 1) {
			return -s[i] * 4
		} else {
			return s[i] * 4
		}
		
	}

	// Draw seed-based background
	function DrawBackground(s, r){
		var m = 300;
		var c = 5;
		
		for (var i=0; i < 22; i++) {
			
			// Pole the axis 
			d = Pole(r, s, i);

			// White or gray
			if (i % 2 == 1){
				c = 6;
			} else {
				c = 5;
			}
			
			// 4 Axis randomness based upon the seed
			Rectangle(m + (d * 3), m + d * 3, r[s[i]] * 40, r[s[i]] * 40, colors[c])
			Rectangle(m + (d * 3), m - d * 3, r[s[i]] * 50, r[s[i]] * 50, colors[c])

			Rectangle(m - (d * 3), m + d * 3, r[s[i]] * 40, r[s[i]] * 40, colors[c])
			Rectangle(m - (d * 3), m - d * 3, r[s[i]] * 50, r[s[i]] * 50, colors[c])

			Rectangle(m, m + (d * 5), r[s[i]] * 50, r[s[i]] * 50, colors[c])
			Rectangle(m, m - (d * 5), r[s[i]] * 50, r[s[i]] * 50, colors[c])

			Rectangle(m + (d * 5), m, r[s[i]] * 50, r[s[i]] * 50, colors[c])
			Rectangle(m - (d * 5), m, r[s[i]] * 50, r[s[i]] * 50, colors[c])
			
		};

	}
	
	
	// Draw seed-based rectangles


	// Draw seed-based lanes
	function DrawLanes(s, r){
		var m = 100;
		var n = 100;
		var d = 16;
		var _c = 0; // Last color to prevent duplicates, thanks to Joris Blaak
		
		// Six lanes per axis
		for (var k=0; k < 6; k++) {
			m = m + s[k] * 9
			n = n + s[k] * 12
			
			// Widths
			if (k <= 2) { d = 24;} else if (k >= 4) { d = 20 } else { d = 16}
			
			// Vertical lanes
			for (var i=0; i < r.length; i++) {
				v = v + r[i];
				if (v > 15){ v = 0; }
				if (_c == (v / 4).toFixed()){
					_c = v / 4 + 1;
				} else {
					_c = (v / 4).toFixed();
				}
				
				Rectangle(m, 16 * i, d, d, colors[_c]);				
			}	
			
			// Horizontal lanes
			for (var i=0; i < r.length; i++) {
				v = v + r[i];
				if (v > 15){ v = 0 }
				if (_c == (v / 4).toFixed()){
					_c = v / 4 + 1;
				} else {
					_c = (v / 4).toFixed();
				}
				
				Rectangle(16 * i, n, d, d, colors[(v / 4).toFixed()]);				
			}
		}
	}

	
	// Save canvas to a data-url
	function Save(){
		
		// Add critical informations
		$("svg").attr({ version: '1.1' , xmlns:"http://www.w3.org/2000/svg"});

		// Get SVG element
		var svg = $("#mondriaan").html();
		 
		// Empty download URL
		$('#download').empty();
		 
		// Encode in Base 64
		var b64 = Base64.encode(svg);
		 
		// Generate Download URL and append to HTML
		$("#download").append($("<a href-lang='image/svg+xml' href='data:image/svg+xml;base64,\n"+b64+"' title='file.svg'>Download</a>"));
		$("#save").fadeIn()
	}
	
	// Close function for the save dialog
	$('.close').click(function(){
		$('#save').fadeOut()
	})
	
</script>
</html>